<style>
  /*================ Testimonial Styles ================*/
  .testimonial-section {
    background: #fff;
    padding: 60px 20px;
    position: relative;
  }

  .testimonial-section::after {
    content: '';
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    height: 1px;
    background: #e0e0e0;
  }

  .testimonial-section::after {
    bottom: 0;
  }

  .testimonial-heading {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: #111;
    margin: 0 0 60px 0;
    padding: 0;
  }

  .testimonial-wrapper {
    position: relative;
    margin: 0 auto;
  }

  .testimonial-container {
    position: relative;
    overflow: hidden;
    min-height: 300px;
    touch-action: pan-y pinch-zoom;
  }

  .testimonial-slider {
    display: flex;
    transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
    will-change: transform;
    touch-action: pan-x;
  }

  .testimonial-slide {
    flex: 0 0 100%;
    max-width: 100%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    padding: 40px 80px;
    box-sizing: border-box;
    gap: 60px;
    min-height: 300px;
  }

  .testimonial-avatar {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .author-avatar {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    overflow: hidden;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .customer_image_div {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    display: block;
  }

  .testimonial-content {
    flex: 1 1 0%;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    min-width: 0;
    @media (max-width: 768px) {
      align-items: center;
      & .testimonial-review{
        text-align: center;
      }
    }
  }

  .testimonial-name {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #111;
  }

  .star-rating {
    font-size: 1.25rem;
    color: #000;
    margin-bottom: 16px;
    line-height: 1;
  }

  .star-rating .star {
    display: inline-block;
  }

  .testimonial-review {
    font-size: 1rem;
    color: #222;
    line-height: 1.6;
    margin: 0;
  }

  .slider-controls {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    transform: translateY(-50%);
    pointer-events: none;
    z-index: 10;
    padding: 0 20px;
  }

  .slider-button {
    background: transparent;
    color: #111;
    border: 2px solid #111;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 1.25rem;
    transition: all 0.2s ease;
    pointer-events: auto;
    padding: 0;
    line-height: 1;
  }

  .slider-button:hover,
  .slider-button:focus {
    background: #f5f5f5;
    outline: none;
  }

  .slider-button:focus-visible {
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
  }

  .slider-dots {
    display: none;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
  }

  .slider-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ddd;
    cursor: pointer;
    transition: background 0.2s ease;
    border: none;
    padding: 0;
  }

  .slider-dot.active {
    background: #111;
  }

  @media (max-width: 900px) {
    .testimonial-section {
      padding: 40px 20px;
    }

    .testimonial-heading {
      font-size: 1.5rem;
      margin-bottom: 40px;
    }

    .testimonial-slide {
      flex-direction: column;
      padding: 40px 60px;
      gap: 30px;
    }

    .testimonial-avatar {
      flex: none;
    }

    .author-avatar {
      width: 140px;
      height: 140px;
    }

    .slider-controls {
      padding: 0 15px;
    }
  }

  @media (max-width: 600px) {
    .testimonial-section {
      padding: 30px 15px;
    }

    .testimonial-heading {
      font-size: 1.25rem;
      margin-bottom: 30px;
    }

    .testimonial-container {
      min-height: 0;
    }

    .testimonial-slide {
      padding: 30px 40px;
      gap: 24px;
    }

    .testimonial-name {
      font-size: 1.2rem;
    }

    .star-rating {
      font-size: 1.1rem;
    }

    .testimonial-review {
      font-size: 0.9rem;
    }

    .author-avatar {
      width: 100px;
      height: 100px;
    }

    .slider-button {
      width: 36px;
      height: 36px;
      font-size: 1rem;
    }

    .slider-controls {
      padding: 0 10px;
    }
  }
</style>

<div class="testimonial-section" role="region" aria-label="Customer testimonials">
  <h2 class="testimonial-heading">{{ section.settings.heading | default: 'What the trost Circle Says' }}</h2>
  <div class="testimonial-wrapper">
    <div class="testimonial-container">
      <div class="testimonial-slider" id="testimonial-slider" tabindex="0">
        {% for block in section.blocks %}
          <div
            class="testimonial-slide"
            role="group"
            aria-roledescription="slide"
            aria-label="Slide {{ forloop.index }} of {{ section.blocks.size }}"
          >
            <div class="testimonial-avatar">
              <div class="author-avatar">
                <img
                  class="customer_image_div"
                  src="{{ block.settings.customer_image | image_url: width: 300, height: 300 }}"
                  width="180"
                  height="180"
                  alt="{{ block.settings.customer_name }}"
                  loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  decoding="async"
                >
              </div>
            </div>
            <div class="testimonial-content">
              <div class="testimonial-name">{{ block.settings.customer_name | escape }}</div>
              <div class="star-rating" role="img" aria-label="5 out of 5 stars">
                <span class="star" aria-hidden="true">&#9733;</span>
                <span class="star" aria-hidden="true">&#9733;</span>
                <span class="star" aria-hidden="true">&#9733;</span>
                <span class="star" aria-hidden="true">&#9733;</span>
                <span class="star" aria-hidden="true">&#9733;</span>
              </div>
              <p class="testimonial-review">{{ block.settings.customer_review | escape }}</p>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="slider-controls">
      <button class="slider-button prev" aria-label="Previous testimonial" aria-controls="testimonial-slider">❮</button>
      <button class="slider-button next" aria-label="Next testimonial" aria-controls="testimonial-slider">❯</button>
    </div>
    <div class="slider-dots" role="tablist">
      {% for block in section.blocks %}
        <button
          class="slider-dot{% if forloop.first %} active{% endif %}"
          role="tab"
          aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
          aria-label="Go to slide {{ forloop.index }}"
          data-index="{{ forloop.index0 }}"
        ></button>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const slider = document.querySelector('.testimonial-slider');
    const slides = document.querySelectorAll('.testimonial-slide');
    const dots = document.querySelectorAll('.slider-dot');
    const prevButton = document.querySelector('.prev');
    const nextButton = document.querySelector('.next');

    if (!slider || slides.length === 0) return;

    let currentIndex = 0;
    const slideCount = slides.length;
    let touchStartX = 0;
    let touchEndX = 0;

    function updateSlider() {
      slider.style.transform = `translateX(-${currentIndex * 100}%)`;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
        dot.setAttribute('aria-selected', index === currentIndex ? 'true' : 'false');
      });
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % slideCount;
      updateSlider();
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + slideCount) % slideCount;
      updateSlider();
    }

    function goToSlide(index) {
      if (index >= 0 && index < slideCount) {
        currentIndex = index;
        updateSlider();
      }
    }

    // Event Listeners
    if (nextButton) {
      nextButton.addEventListener('click', nextSlide);
    }
    if (prevButton) {
      prevButton.addEventListener('click', prevSlide);
    }

    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        goToSlide(index);
      });
    });

    // Touch events
    if (slider) {
      slider.addEventListener(
        'touchstart',
        (e) => {
          touchStartX = e.touches[0].clientX;
        },
        { passive: true }
      );

      slider.addEventListener(
        'touchmove',
        (e) => {
          touchEndX = e.touches[0].clientX;
        },
        { passive: true }
      );

      slider.addEventListener('touchend', () => {
        const diff = touchStartX - touchEndX;
        if (Math.abs(diff) > 50) {
          if (diff > 0) {
            nextSlide();
          } else {
            prevSlide();
          }
        }
      });

      // Keyboard navigation
      slider.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          prevSlide();
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          nextSlide();
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Testimonial",
  "class": "shopify-section-testimonial content-area",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What the trost Circle Says"
    }
  ],
  "max_blocks": 15,
  "blocks": [
    {
      "type": "feature",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "customer_image",
          "label": "Customer Image"
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name",
          "default": "Customer Name"
        },
        {
          "type": "textarea",
          "id": "customer_review",
          "label": "Customer Review",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam scelerisque posuere vivamus egestas porttitor. Hendrerit vitae at nulla varius proin ipsum."
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Image",
      "name": "Testimonial",
      "blocks": [
        {
          "type": "feature"
        },
        {
          "type": "feature"
        },
        {
          "type": "feature"
        }
      ]
    }
  ]
}
{% endschema %}
